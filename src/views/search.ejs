<%- include('includes/head') %>
<body>
<%- include('includes/nav') %>
<div id="content">
<main>
    <h2>Search</h2>
    <div id="search-menu">
    <form class="d-inline-flex form-inline my-2 my-lg-0">
        <input class="w-50 form-control mr-sm-2" type="search" aria-label="Search" id="searchInput">
        <button class="btn btn-outline-success my-2 my-sm-0" type="button" id="searchBtn"><i class='bx bx-search-alt-2'></i></button>
    </form>
    <div class="d-inline-flex gap-3">
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" checked>
            <label class="form-check-label" for="flexRadioDefault2">
                Book
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
            <label class="form-check-label" for="flexRadioDefault1">
            Series
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
            <label class="form-check-label" for="flexRadioDefault1">
            Author
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
            <label class="form-check-label" for="flexRadioDefault1">
            User  
            </label>
        </div>
    </div>
    </div>
    <div id="resultsContainer"></div>
    <script>
        document.getElementById('searchBtn').addEventListener('click', async () => {
            const searchInput = document.getElementById('searchInput').value.trim();
            if (!searchInput) return;
            
            const selectedType = document.querySelector('input[name="flexRadioDefault"]:checked').nextElementSibling.innerText.toLowerCase().trim();
            if (!selectedType) { 
                console.log('Nenhum tipo foi selecionado'); 
                return;
            }
            
            const endpointMap = {
                book: "/books/search/",
                series: "/series/search/",
                author: "/author/search/",
                user: "/user/search/"
            };
        
            const url = endpointMap[selectedType] + encodeURIComponent(searchInput) + "?render=true";
        
            try {
                const response = await fetch(url);
                const html = await response.text();
                document.getElementById('resultsContainer').innerHTML = html;
            } catch (error) {
                console.error("Error fetching search results:", error);
                document.getElementById('resultsContainer').innerHTML = "<p class='text-danger'>Error fetching results.</p>";
            }
        });
    </script> 
</main>
</div>
<script src="/assets/js/links.js"></script>
<script src="/assets/js/stars.js"></script>
</body>
</html>